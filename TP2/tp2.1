#!/usr/sbin/dtrace -s

syscall::openat:entry
{
	self->execname = execname;
	self->pid = pid;
	self->uid = uid;
	self->gid = gid;
	self->file = arg1;
	self->flags = arg2;
}


syscall::openat:return
/self->file != 0 && substr(copyinstr(self->file), 0, 5) == "/etc/"/
{

	printf("%s %d %d %d %s %d %d", self->execname,self->pid,self->uid, self->gid, copyinstr(self->file), self->flags, arg0); 
}

syscall::openat:return
{
	self->execname = 0;
	self->pid = 0;
	self->uid = 0;
	self->gid = 0;
	self->file = 0;
	self->flags = 0;
}	
